<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocket Test</h1>
    <div id="messages"></div>
    
    <script>
        const messagesDiv = document.getElementById('messages');
        
        function log(message) {
            const div = document.createElement('div');
            div.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            messagesDiv.appendChild(div);
            console.log(message);
            
            // Keep only last 20 messages
            if (messagesDiv.children.length > 20) {
                messagesDiv.removeChild(messagesDiv.firstChild);
            }
        }
        
        log('Connecting to WebSocket...');
        const ws = new WebSocket('ws://localhost:8080/ws');
        
        ws.onopen = function(event) {
            log('✅ WebSocket connected');
        };
        
        ws.onmessage = function(event) {
            try {
                const data = JSON.parse(event.data);
                if (data.type === 'statistics_update') {
                    log(`📊 StatisticsUpdate: UAM=${data.data.metrics.uam.toFixed(2)}, cost=$${data.data.metrics.cost_per_minute.toFixed(4)}`);
                } else if (data.type === 'attribute_update') {
                    log(`🔄 AttributeUpdate: ${data.data.attributes.length} attributes`);
                } else {
                    log(`📨 ${data.type}: ${JSON.stringify(data).substring(0, 100)}...`);
                }
            } catch (e) {
                log(`❌ Parse error: ${e.message}`);
                log(`Raw data: ${event.data.substring(0, 200)}...`);
            }
        };
        
        ws.onclose = function(event) {
            log(`❌ WebSocket closed: ${event.code} - ${event.reason}`);
        };
        
        ws.onerror = function(error) {
            log(`❌ WebSocket error: ${error}`);
        };
    </script>
</body>
</html>